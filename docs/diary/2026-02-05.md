# 2026-02-05: Day 5 — 意気込み

## 今日の意気込み

今日一日、こんなことが出来たらいいな、というのは「GUI の HUD 更新間隔を自分で調整できるようにして、観察しやすさを上げる」こと。昨日の GUI/HUD 追加は形になったので、今日は“使い勝手”の部分まで一歩進めて、再現しやすい観察ループを作りたい。

## 実装メモ

HUD の更新間隔を IPC で指定できるようにした。ここでいう **tick interval** は「GUI サービスのメインループが何回回ったら HUD を再描画するか」という意味で、時間そのものではなく **ループ回数ベースの間隔** になる。  
`gui hud on [interval]` の形で指定できるようにし、未指定なら従来通りのデフォルトで動くようにした。これで観察の粒度を変えられるようになり、HUD が“見たい頻度で更新される”状態になった。

## これから: GUI 電卓アプリに向けて必要なもの

今日の次の目標は **GUI 上で電卓が動く**こと。今ある GUI/IPC の土台を活かしつつ、次の要素が必要になると整理した。

1. **電卓アプリ本体 (ユーザー空間 ELF)**
   - 画面レイアウト（表示部 + ボタン）
   - 入力状態の管理（現在値/演算子/左項）
   - 四則演算のロジックと例外扱い（ゼロ除算など）

2. **GUI クライアント API の拡張（任意矩形の再描画）**
   - `clear/rect/text/present` は揃っているので、電卓 UI の描画は可能
   - ただし「部分更新」や「描き直しやすい構成」のために、**UI 描画を関数化**しておく必要がある

3. **入力の仕組み**
   - まずは **キーボード入力**で十分（マウスクリックは後回し）
   - シェルの入力と同じ read 系を使って、1 文字ずつ受け取る
   - `0-9`, `+ - * /`, `=` , `C` を受け付ける

4. **アプリ起動の導線**
   - `CALC.ELF` を disk image に含める
   - `run /CALC.ELF` で起動できるようにする

5. **テスト・再現性**
   - 最低限、`selftest` で起動確認 + IPC の応答確認を入れる余地がある
   - ただし GUI の描画内容は自動検証が難しいので、**起動ログと IPC 返答**で確認する形にする

## 実装: GUI 電卓アプリ（最小）

`CALC.ELF` を追加して、GUI 上で動く電卓の最小形を作った。入力はまず **キーボード**だけに割り切り、`0-9`, `+ - * /`, `=`, `C` を受け付ける。GUI 側は「表示部 + ボタン」を描くだけで、**クリックは後回し**。  
`gui_client` 経由で `rect/text/present` を組み合わせ、表示部は毎回再描画して更新する方式にした。数字入力や演算の状態は小さな状態機械で管理し、**fresh_entry（次の数字で置き換える）**というフラグで「演算子を押した直後の入力」を扱っている。

Makefile に `CALC.ELF` を追加して、`run /CALC.ELF` で起動できるようにした。これで「GUI でアプリが動く」最小ラインに到達できた。
